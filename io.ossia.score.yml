id: io.ossia.score
runtime: org.kde.Platform
runtime-version: "6.9"
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm20
build-options:
  env:
    CXX: /usr/lib/sdk/llvm20/bin/clang++
command: ossia-score
rename-desktop-file: ossia-score.desktop
rename-icon: ossia-score
rename-appdata-file: ossia-score.appdata.xml
finish-args:
  # BLE support
  - --allow=bluetooth
  - --system-talk-name=org.bluez

  # Access user's data and media libraries, plug-ins etc
  - --filesystem=host

  # Required for USB, Webcam devices support as well as raw GPIO I/O & GPU rendering
  - --device=all

  # X11 is used by default
  - --socket=x11

  # Used by X11
  - --share=ipc

  # Network access
  - --share=network

  # PulseAudio is needed for ALSA device access
  - --socket=pulseaudio

  # Audio support through pipewire
  - --filesystem=xdg-run/pipewire-0

  # Plugins
  - --env=VST_PATH=/app/extensions/Plugins/vst
  - --env=VST3_PATH=/app/extensions/Plugins/vst3

  # Required to allow screensaver/idle inhibition
  - --talk-name=org.freedesktop.ScreenSaver

add-extensions:
  # Linux audio plugins base extension
  org.freedesktop.LinuxAudio.Plugins:
    directory: extensions/Plugins
    version: "24.08"
    add-ld-path: lib
    merge-dirs: vst;vst3;lv2
    subdirectories: true
    no-autodownload: true

  # Full codec support for FFMPEG
  org.freedesktop.Platform.ffmpeg-full:
    directory: lib/ffmpeg
    add-ld-path: .
    version: "24.08"

cleanup:
  - /bin/avahi*
  - /include
  - "*.a"
  - "*.la"
  - "*.java"
  - "*.d"
  - "*.cs"
  - "/share/faust/*.cpp"
  - "/share/faust/*.h"
  - /share/faust/api
  - /share/faust/AU
  - /share/faust/audiokit
  - /share/faust/autodiff
  - /share/faust/chaos-stratus
  - /share/faust/cmajor
  - /share/faust/daisy
  - /share/faust/esp32
  - /share/faust/examples
  - /share/faust/iOS
  - /share/faust/juce
  - /share/faust/julia
  - /share/faust/max-msp
  - /share/faust/nodejs
  - /share/faust/osclib
  - /share/faust/sam
  - /share/faust/smartKeyboard
  - /share/faust/juce
  - /share/faust/svgplot
  - /share/faust/teensy
  - /share/faust/unity
  - /share/faust/rust
  - /share/faust/vcvrack
  - /share/faust/webaudio
  - /share/faust/js
  - /lib/cmake
  - /lib/girepository-1.0
  - /lib/pkgconfig
  - /lib/avahi
  - /lib/python*
  - /share/gir-1.0
  - /share/man
  - /share/pkgconfig
  - /share/aclocal
  - /share/gtk-doc
  - /share/doc
  - /share/info
  - /share/pixmaps
  - /share/async-mqtt5
  - /man

modules:
  # LV2 audio plugin support
  - shared-modules/linux-audio/lv2.json
  - shared-modules/linux-audio/lilv.json

  # Audio I/O
  - name: faust
    buildsystem: cmake-ninja
    subdir: build
    config-opts:
      - -Wno-dev
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_POSITION_INDEPENDENT_CODE=ON
      - -DCMAKE_PREFIX_PATH=/usr/lib/sdk/llvm20
      - -DLLVM_CONFIG=/usr/lib/sdk/llvm20/bin/llvm-config
      - -DBUILD_SHARED_LIBS=ON
      - -DINCLUDE_OSC=0
      - -DINCLUDE_HTTP=0
      - -DINCLUDE_EXECUTABLE=0
      - -DINCLUDE_STATIC=0
      - -DINCLUDE_DYNAMIC=1
      - -DINCLUDE_WASM_GLUE=0
      - -DLINK_LLVM_STATIC=0
      - -DINCLUDE_LLVM=1
      - -DC_BACKEND=COMPILER
      - -DCODEBOX_BACKEND=OFF
      - -DCPP_BACKEND=COMPILER
      - -DCMAJOR_BACKEND=OFF
      - -DCSHARP_BACKEND=OFF
      - -DFIR_BACKEND=OFF
      - -DINTERP_BACKEND=OFF
      - -DJAVA_BACKEND=OFF
      - -DJAX_BACKEND=OFF
      - -DJSFX_BACKEND=OFF
      - -DJULIA_BACKEND=OFF
      - -DLLVM_BACKEND=COMPILER
      - -DOLDCPP_BACKEND=OFF
      - -DRUST_BACKEND=OFF
      - -DSDF3_BACKEND=OFF
      - -DVHDL_BACKEND=OFF
      - -DWASM_BACKEND=OFF
    sources:
      - type: archive
        url: https://github.com/grame-cncm/faust/releases/download/2.79.3/faust-2.79.3.tar.gz
        sha256: ca2171cb136f135960be10fee2c1728304865a5d5190e9a03cace88b4936c558
